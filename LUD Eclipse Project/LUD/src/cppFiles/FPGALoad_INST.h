int Inst[82][12] = {{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 1073741824, 17248522, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 33554432, 0, 0, 0},{0, 83886144, 24, 1879048192, 1547229297, 1193508, 0, 0, 4, 16384, 16, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 32768, 32, 0},{0, 0, 0, 0, 0, 688896, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 134217728, 0},{201326592, 32, 0, 1056768, 0, 0, 4194304, 12288, 12, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 49152, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 8388608, 0, 8, 0, 0, 0},{256, 0, 20480, 0, 0, 1060096, 1, 0, 0, 0, 201326592, 0},{0, 0, 0, 0, 0, 0, 0, 8192, 8, 0, 0, 0},{0, 0, 0, 0, 0, 1094784, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 12582912, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 12288, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}};
int total_instructions = 82;
int sub_instructions = 12;


void delay_FPGALoad_INST(){
int count = 100;
for(int i=0;i<count;){
i = i + 1;
}
}


//Function to initialize/clear the Inst BRAM
void clearINSTBram(){
int i,j;
//Making enable and write_enable 0 for Instruction BRAMS
Xil_Out32(XPAR_MYIP_LUDECOMPOSITION_0_BASEADDR + 4*25, 0); //Making enable 0
delay_FPGALoad_INST();
Xil_Out32(XPAR_MYIP_LUDECOMPOSITION_0_BASEADDR + 4*26, 0); //Making write enable 0
delay_FPGALoad_INST();
//Writing 0 into BRAM
for(i=0;i<4096;i++){
Xil_Out32(XPAR_MYIP_LUDECOMPOSITION_0_BASEADDR + 4*24, i); //Writing address
delay_FPGALoad_INST();
for(j=0;j<sub_instructions;j++){
Xil_Out32(XPAR_MYIP_LUDECOMPOSITION_0_BASEADDR + 4*(27+j), 0); //Writing data in din
delay_FPGALoad_INST();
}
Xil_Out32(XPAR_MYIP_LUDECOMPOSITION_0_BASEADDR + 4*25, 1); //Making enable 1
delay_FPGALoad_INST();
Xil_Out32(XPAR_MYIP_LUDECOMPOSITION_0_BASEADDR + 4*26, 1); //Making write enable 1
delay_FPGALoad_INST();
Xil_Out32(XPAR_MYIP_LUDECOMPOSITION_0_BASEADDR + 4*25, 0); //Making enable 0
delay_FPGALoad_INST();
Xil_Out32(XPAR_MYIP_LUDECOMPOSITION_0_BASEADDR + 4*26, 0); //Making write enable 0
delay_FPGALoad_INST();
}
}


//Function to verify if the data BRAMs is properly cleared
void verifyClearINSTBram(){
int i,j;
int val,error_count;
error_count = 0;
//Making enable and write enable zero for Instruction BRAM
Xil_Out32(XPAR_MYIP_LUDECOMPOSITION_0_BASEADDR + 4*25, 0); //Making enable 0
delay_FPGALoad_INST();
Xil_Out32(XPAR_MYIP_LUDECOMPOSITION_0_BASEADDR + 4*26, 0); //Making write enable 0
delay_FPGALoad_INST();
//Reading Instructions from BRAM
for(i=0;i<4096;i++){
Xil_Out32(XPAR_MYIP_LUDECOMPOSITION_0_BASEADDR + 4*24, i); //Writing address,i is the offset
delay_FPGALoad_INST();
Xil_Out32(XPAR_MYIP_LUDECOMPOSITION_0_BASEADDR + 4*25, 1); //Making enable 1
delay_FPGALoad_INST();
for(j=0;j<sub_instructions;j++){
val = Xil_In32(XPAR_MYIP_LUDECOMPOSITION_0_BASEADDR + 4*(39+j)); //Reading from BRAM
delay_FPGALoad_INST();
if(val != 0){
error_count = error_count + 1;
}
}
Xil_Out32(XPAR_MYIP_LUDECOMPOSITION_0_BASEADDR + 4*25, 0); //Making enable 0
delay_FPGALoad_INST();
}
printf("Initialization errors in INST BRAMs = %d\n",error_count);
}


//Function to write data into BRAM
void FPGALoadINST(){
int i,j;
//The base address of the LUD accelerator may needed to be changed. The base address assumed is 'XPAR_MYIP_LUDECOMPOSITION_0_BASEADDR'
//Making enable and write_enable 0 for Instruction BRAMS
Xil_Out32(XPAR_MYIP_LUDECOMPOSITION_0_BASEADDR + 4*25, 0); //Making enable 0
delay_FPGALoad_INST();
Xil_Out32(XPAR_MYIP_LUDECOMPOSITION_0_BASEADDR + 4*26, 0); //Making write enable 0
delay_FPGALoad_INST();
//Writing Instructions into BRAM
for(i=0;i<total_instructions;i++){
Xil_Out32(XPAR_MYIP_LUDECOMPOSITION_0_BASEADDR + 4*24, i); //Writing address,i is the offset
delay_FPGALoad_INST();
for(j=0;j<sub_instructions;j++){
Xil_Out32(XPAR_MYIP_LUDECOMPOSITION_0_BASEADDR + 4*(27+j), Inst[i][j]); //Writing data in din
delay_FPGALoad_INST();
}
Xil_Out32(XPAR_MYIP_LUDECOMPOSITION_0_BASEADDR + 4*25, 1); //Making enable 1
delay_FPGALoad_INST();
Xil_Out32(XPAR_MYIP_LUDECOMPOSITION_0_BASEADDR + 4*26, 1); //Making write enable 1
delay_FPGALoad_INST();
Xil_Out32(XPAR_MYIP_LUDECOMPOSITION_0_BASEADDR + 4*25, 0); //Making enable 0
delay_FPGALoad_INST();
Xil_Out32(XPAR_MYIP_LUDECOMPOSITION_0_BASEADDR + 4*26, 0); //Making write enable 0
delay_FPGALoad_INST();
}
}


//Function to verify if Instructions is properly loaded into BRAMs
void verify_INST_FPGALoad(){
int i,j,val_int;
//Making enable and write enable zero for Instruction BRAM
Xil_Out32(XPAR_MYIP_LUDECOMPOSITION_0_BASEADDR + 4*25, 0); //Making enable 0
delay_FPGALoad_INST();
Xil_Out32(XPAR_MYIP_LUDECOMPOSITION_0_BASEADDR + 4*26, 0); //Making write enable 0
delay_FPGALoad_INST();
//Reading Instructions from BRAM
for(i=0;i<total_instructions;i++){
Xil_Out32(XPAR_MYIP_LUDECOMPOSITION_0_BASEADDR + 4*24, i); //Writing address,i is the offset
delay_FPGALoad_INST();
Xil_Out32(XPAR_MYIP_LUDECOMPOSITION_0_BASEADDR + 4*25, 1); //Making enable 1
delay_FPGALoad_INST();
for(j=0;j<sub_instructions;j++){
val_int = Xil_In32(XPAR_MYIP_LUDECOMPOSITION_0_BASEADDR + 4*(39+j)); //Reading from BRAM
delay_FPGALoad_INST();
if(val_int != Inst[i][j]){
printf("Error in verification, i = %d, j = %d, Correct value = %d, BRAM value = %d\n",i,j,Inst[i][j],val_int);
}
}
Xil_Out32(XPAR_MYIP_LUDECOMPOSITION_0_BASEADDR + 4*25, 0); //Making enable 0
delay_FPGALoad_INST();
}
}


